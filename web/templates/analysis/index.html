{% extends "base.html" %}

{% block title %}Analysis - Strava Local{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Performance Analysis</h1>
    <p class="page-subtitle">Your personal records and statistics</p>
</div>

<!-- Personal Records -->
<h2 class="section-title">Personal Records</h2>
<div class="records-grid stagger-children">
    {% if records.longest_distance %}
    <div class="record-card animate-slide-up">
        <div class="record-card__icon">
            <span class="record-icon">&#x1F3C5;</span>
        </div>
        <div class="record-card__content">
            <div class="record-card__label">Longest Distance</div>
            <div class="record-card__value">{{ "{:.1f}".format(records.longest_distance.distance / 1609.34) }} mi</div>
            <a href="/activities/{{ records.longest_distance.activity_id }}" class="record-card__link">
                {{ records.longest_distance.name or 'Unnamed' }}
            </a>
            <span class="record-card__date">
                {{ records.longest_distance.start_time.strftime('%b %d, %Y') if records.longest_distance.start_time else '' }}
            </span>
        </div>
    </div>
    {% endif %}

    {% if records.longest_time %}
    <div class="record-card animate-slide-up">
        <div class="record-card__icon">
            <span class="record-icon">&#x23F1;</span>
        </div>
        <div class="record-card__content">
            <div class="record-card__label">Longest Duration</div>
            <div class="record-card__value">{{ (records.longest_time.moving_time // 3600)|int }}:{{ "%02d"|format((records.longest_time.moving_time % 3600) // 60) }}</div>
            <a href="/activities/{{ records.longest_time.activity_id }}" class="record-card__link">
                {{ records.longest_time.name or 'Unnamed' }}
            </a>
            <span class="record-card__date">
                {{ records.longest_time.start_time.strftime('%b %d, %Y') if records.longest_time.start_time else '' }}
            </span>
        </div>
    </div>
    {% endif %}

    {% if records.highest_climb %}
    <div class="record-card animate-slide-up">
        <div class="record-card__icon">
            <span class="record-icon">&#x26F0;</span>
        </div>
        <div class="record-card__content">
            <div class="record-card__label">Most Elevation</div>
            <div class="record-card__value">{{ "{:,.0f}".format(records.highest_climb.elevation_gain * 3.281) }} ft</div>
            <a href="/activities/{{ records.highest_climb.activity_id }}" class="record-card__link">
                {{ records.highest_climb.name or 'Unnamed' }}
            </a>
            <span class="record-card__date">
                {{ records.highest_climb.start_time.strftime('%b %d, %Y') if records.highest_climb.start_time else '' }}
            </span>
        </div>
    </div>
    {% endif %}

    {% if records.fastest_speed %}
    <div class="record-card animate-slide-up">
        <div class="record-card__icon">
            <span class="record-icon">&#x26A1;</span>
        </div>
        <div class="record-card__content">
            <div class="record-card__label">Fastest Speed</div>
            <div class="record-card__value">{{ "{:.1f}".format(records.fastest_speed.max_speed * 2.237) }} mph</div>
            <a href="/activities/{{ records.fastest_speed.activity_id }}" class="record-card__link">
                {{ records.fastest_speed.name or 'Unnamed' }}
            </a>
            <span class="record-card__date">
                {{ records.fastest_speed.start_time.strftime('%b %d, %Y') if records.fastest_speed.start_time else '' }}
            </span>
        </div>
    </div>
    {% endif %}

    {% if records.highest_hr %}
    <div class="record-card animate-slide-up">
        <div class="record-card__icon">
            <span class="record-icon">&#x2764;</span>
        </div>
        <div class="record-card__content">
            <div class="record-card__label">Max Heart Rate</div>
            <div class="record-card__value">{{ "{:.0f}".format(records.highest_hr.max_hr) }} bpm</div>
            <a href="/activities/{{ records.highest_hr.activity_id }}" class="record-card__link">
                {{ records.highest_hr.name or 'Unnamed' }}
            </a>
            <span class="record-card__date">
                {{ records.highest_hr.start_time.strftime('%b %d, %Y') if records.highest_hr.start_time else '' }}
            </span>
        </div>
    </div>
    {% endif %}

    {% if records.most_calories %}
    <div class="record-card animate-slide-up">
        <div class="record-card__icon">
            <span class="record-icon">&#x1F525;</span>
        </div>
        <div class="record-card__content">
            <div class="record-card__label">Most Calories</div>
            <div class="record-card__value">{{ "{:,.0f}".format(records.most_calories.calories) }}</div>
            <a href="/activities/{{ records.most_calories.activity_id }}" class="record-card__link">
                {{ records.most_calories.name or 'Unnamed' }}
            </a>
            <span class="record-card__date">
                {{ records.most_calories.start_time.strftime('%b %d, %Y') if records.most_calories.start_time else '' }}
            </span>
        </div>
    </div>
    {% endif %}
</div>

<!-- Heart Rate Stats -->
{% if hr_stats.has_data %}
<h2 class="section-title mt-xl">Heart Rate Statistics</h2>
<div class="dashboard-stats stagger-children">
    <div class="stat-card animate-slide-up">
        <div class="stat-card__header">Activities with HR</div>
        <div class="stat-card__value">{{ hr_stats.activities_with_hr }}</div>
        <div class="stat-card__footer">Total tracked</div>
    </div>
    <div class="stat-card animate-slide-up">
        <div class="stat-card__header">Average HR</div>
        <div class="stat-card__value">
            {{ hr_stats.average_hr }}
            <span class="stat-card__unit">bpm</span>
        </div>
        <div class="stat-card__footer">Across all activities</div>
    </div>
    <div class="stat-card animate-slide-up">
        <div class="stat-card__header">Max HR Ever</div>
        <div class="stat-card__value">
            {{ hr_stats.max_hr_ever|int }}
            <span class="stat-card__unit">bpm</span>
        </div>
        <div class="stat-card__footer">Personal best</div>
    </div>
</div>
{% endif %}

<!-- Link to detailed records -->
<div class="mt-xl">
    <a href="/analysis/records" class="btn btn--secondary">View Records by Activity Type â†’</a>
</div>
{% endblock %}
